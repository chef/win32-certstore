---
expeditor:
  defaults:
    buildkite:
      retry:
        automatic:
          limit: 1
      timeout_in_minutes: 30

# why do we test on Linux? It's the easiest way to run specs quickly on multiple ruby versions so we test on Windows and then on various ruby releases using Linux agents
steps:
- label: lint-chefstyle
  command:
    - .expeditor/run_linux_tests.sh "rake style"
  expeditor:
    executor:
      docker:
        image: ruby:2.7-buster

- label: run-specs-ruby-2.6
  command:
    - .expeditor/run_linux_tests.sh rspec
  expeditor:
    executor:
      docker:
        image: ruby:2.6-buster

- label: run-specs-ruby-2.7
  command:
    - .expeditor/run_linux_tests.sh rspec
  expeditor:
    executor:
      docker:
        image: ruby:2.7-buster

- label: run-specs-ruby-3.0
  command:
    - .expeditor/run_linux_tests.sh rspec
  expeditor:
    executor:
      docker:
        image: ruby:3.0-buster

- label: "run specs :windows:"
  command:
    - bundle config set --local without docs debug
    - bundle install --jobs=7 --retry=3
    - bundle exec rake spec
  expeditor:
    executor:
      docker:
        host_os: windows
